#!/usr/bin/env bash

# Pre-push hook to prevent pushing commits that were created on main.
# Copy to .git/hooks/pre-push and chmod +x to enable.

set -euo pipefail

branch="$(git rev-parse --abbrev-ref HEAD)"

if [[ "$branch" == "main" ]]; then
  echo "[pre-push] Direct commits on 'main' are disallowed. Create a feature branch and open a PR." >&2
  exit 1
fi

if ! command -v pnpm >/dev/null 2>&1; then
  echo "[pre-push] pnpm not found. Install pnpm to run verification." >&2
  exit 1
fi

echo "[pre-push] full verify"
pnpm verify

echo "[pre-push] local e2e"
./scripts/run-e2e-local.sh
